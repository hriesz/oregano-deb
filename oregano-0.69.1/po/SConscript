import os
import os.path
import glob

Import ('CEnv')

#potfiles_in = open('POTFILES.in', 'w')

#intl_files.sort()

#print "Generating POTFILES.in in po/"

#potfiles_in.write("""# This file was automatically generated by a configuration script.
# Contains a list of source files containing translatable
# strings sorted alphabetically.
#[encoding: UTF-8]
#""")

#for f in intl_files[:]:
#    potfiles_in.write(f + '\n')

#potfiles_in.close()

print "Updating pot file: "

domain = CEnv['DOMAIN']
potfile = CEnv['POTFILE']

if 'update-pot' in COMMAND_LINE_TARGETS:
	poaction = Action('intltool-update -p -g=' + domain)
	Execute(poaction)

# this should probably be merged with the i18n builder somehow

p_oze = [ os.path.basename (po) for po in glob.glob ('*.po') ]
languages = [ po.replace ('.po', '') for po in p_oze ]
m_oze = [ po.replace (".po", ".mo") for po in p_oze ]
    
for mo in m_oze[:]:
    po = mo.replace (".mo", ".po")
    CEnv.Alias ('install', CEnv.MoBuild (mo, [ po, potfile ]))
        
for lang in languages[:]:
    modir = (os.path.join (CEnv['INSTALL_DIR'], 'share/locale/' + lang + '/LC_MESSAGES/'))
    moname = domain + '.mo'
    CEnv.Alias('install', CEnv.InstallAs (os.path.join (modir, moname), lang + '.mo'))

